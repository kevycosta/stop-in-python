{% extends "layout.html" %}

{% block title %}
    Play
{% endblock %}

{% block main %}
    <section style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <div class="d-flex align-items-center justify-content-center bg-black rounded-2 p-2 w-75 mb-5">
            <h1>Rodadas: {{current_round}} / 10</h1>
            <div class="mx-4 bg-white d-flex rounded-3" style="padding: 0px 1px; height: 40px;"></div>
            <h1 class="d-inline-flex">Sala &nbsp<div class="fw-bold " id="room_id_value">{{room_id}}</div></h1>
        </div>
        <div class="progress my-2" style="width: 75%;">
            <div 
                class="progress-bar" 
                role="progressbar" 
                id="progressBar"
                aria-label="Basic example" 
                aria-valuenow="0" 
                aria-valuemin="0" 
                aria-valuemax="100"
            ></div>
        </div>
        
        {% if is_admin %}
            <button 
                class="btn btn-success" 
                onclick="startRound()"
            >
                START GAME
            </button>
        {% endif %}
        
        
        <div class="d-flex align-items-start  justify-content-center w-100 ">
            <div class="d-flex flex-column gap-2 w-25">
                <div class="d-flex align-items-center justify-content-start">
                    <i 
                        data-feather="user"
                        class="p-2 rounded-circle bg-secondary me-3"
                        style="height: 64px; width: 64px;"
                    ></i>
                    <div class="d-flex flex-column align-items-center justify-content-start">
                        <h3 class="fs-4">Kevy Costa</h3>
                        <h3 class="fs-4 fw-bolder">220 pts</h3>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-start">
                    <i 
                        data-feather="user"
                        class="p-2 rounded-circle bg-secondary me-3"
                        style="height: 64px; width: 64px;"
                    ></i>
                    <div class="d-flex flex-column align-items-center justify-content-start">
                        <h3 class="fs-4">Kevy Costa</h3>
                        <h3 class="fs-4 fw-bolder">220 pts</h3>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-start">
                    <i 
                        data-feather="user"
                        class="p-2 rounded-circle bg-secondary me-3"
                        style="height: 64px; width: 64px;"
                    ></i>
                    <div class="d-flex flex-column align-items-center justify-content-start">
                        <h3 class="fs-4">Kevy Costa</h3>
                        <h3 class="fs-4 fw-bolder">220 pts</h3>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-start">
                    <i 
                        data-feather="user"
                        class="p-2 rounded-circle bg-secondary me-3"
                        style="height: 64px; width: 64px;"
                    ></i>
                    <div class="d-flex flex-column align-items-center justify-content-start">
                        <h3 class="fs-4">Kevy Costa</h3>
                        <h3 class="fs-4 fw-bolder">220 pts</h3>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-start">
                    <i 
                        data-feather="user"
                        class="p-2 rounded-circle bg-secondary me-3"
                        style="height: 64px; width: 64px;"
                    ></i>
                    <div class="d-flex flex-column align-items-center justify-content-start">
                        <h3 class="fs-4">Kevy Costa</h3>
                        <h3 class="fs-4 fw-bolder">220 pts</h3>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-start">
                    <i 
                        data-feather="user"
                        class="p-2 rounded-circle bg-secondary me-3"
                        style="height: 64px; width: 64px;"
                    ></i>
                    <div class="d-flex flex-column align-items-center justify-content-start">
                        <h3 class="fs-4">Kevy Costa</h3>
                        <h3 class="fs-4 fw-bolder">220 pts</h3>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-start">
                    <i 
                        data-feather="user"
                        class="p-2 rounded-circle bg-secondary me-3"
                        style="height: 64px; width: 64px;"
                    ></i>
                    <div class="d-flex flex-column align-items-center justify-content-start">
                        <h3 class="fs-4">Kevy Costa</h3>
                        <h3 class="fs-4 fw-bolder">220 pts</h3>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-start">
                    <i 
                        data-feather="user"
                        class="p-2 rounded-circle bg-secondary me-3"
                        style="height: 64px; width: 64px;"
                    ></i>
                    <div class="d-flex flex-column align-items-center justify-content-start">
                        <h3 class="fs-4">Kevy Costa</h3>
                        <h3 class="fs-4 fw-bolder">220 pts</h3>
                    </div>
                </div>
            </div>
            <div class="d-flex flex-column gap-4 w-50">
                <h1 class="fw-bolder">PREENCHA OS CAMPOS</h1>
                <form class="row row-cols-3">
                    {% for element in themes_data %}
                        <div class="col" style="width: 18rem; height: 6rem;">
                            <label for="element.question_title">{{element.question_title}}</label>      
                            <input 
                                type="text" 
                                name="{{element.question_title}}" 
                                id="element.question_id" 
                                autocomplete="off" 
                                autofocus 
                                class="form-control mx-auto w-auto"
                            >      
                        </div>
                    {% endfor %}                    
                </form>
                <div class="d-flex align-items-center justify-content-center ">
                    <button
                        type="button"
                        class="btn btn-danger w-25 fw-bold"
                        onclick="finishRound()"
                    >
                        STOP
                    </button>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script>
        const socket = io({autoConnect: false});

        socket.connect();

        socket.on('connect', () => {
            console.log('Connected to Socket.IO server');
        });

        // socket.on('allUsersLogged', () => {
        //     console.log('Connected to Socket.IO server');
        // });

        function startRound () {
            socket.emit('startRound');
        }

        function finishRound () {
            socket.emit('finishRound');
        }

        socket.on('progress_update', (data) => {
            // console.log('Test', data);
            let value = data.progress;
            var progressBar = document.getElementById('progressBar');
            let percent = Math.round((value / 90) * 100);

            progressBar.style.width = percent + '%';
            progressBar.setAttribute("aria-valuenow", String(percent));

            if (percent == 100) {
                finishRound();
            }
        });
    </script>
{% endblock %}